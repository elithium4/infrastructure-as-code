all:
  vars:
    ansible_ssh_private_key_file: ".vagrant/machines/{{ inventory_hostname }}/virtualbox/private_key"
  vars_files:
    - ./inventories/group_vars/app.yml
  children:
    app:
      hosts: app
      roles: docker
      - name: Clone repository
        git:
          repo: "{{ repository_url }}"
          dest: /home/{{ ansible_user}}/{{ repository_dir }}

      - name: Start application from repository
        community.docker.docker_container:
          image: "{{ app_image }}"
          ports:
            - 8000:8000
          name: "{{ app_name }}"
          detach: true
          state: started
    web:
      hosts: web
      roles: nginx
